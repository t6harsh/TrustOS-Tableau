<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrustOS - Dashboard Safety Layer</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Tableau Extensions API -->
    <script src="tableau.extensions.1.latest.min.js"></script>

    <link rel="stylesheet" href="styles.css">
</head>

<body class="state-loading">

    <!-- App Container (Single Column, Scrollable) -->
    <div class="app-container">

        <!-- Header -->
        <header class="app-header">
            <div class="brand">
                <div class="brand-icon">üõ°Ô∏è</div>
                <div class="brand-info">
                    <h1 class="brand-name">TrustOS</h1>
                    <span class="brand-status">System Active</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn-icon" onclick="runAudit()" title="Run Audit">üîÑ</button>
            </div>
        </header>

        <!-- Scrollable Content -->
        <main class="app-content">

            <!-- Hero Section: System Status -->
            <section class="status-hero safe"> <!-- Toggle class: safe/warning/locked -->
                <div class="hero-ring">
                    <div class="hero-icon">‚úì</div>
                </div>
                <h2 id="status-text">System Trusted</h2>
                <p id="alert-message">All metrics within safe operating bounds.</p>
            </section>

            <!-- Key Metrics Grid -->
            <section class="metrics-grid">
                <div class="metric-card">
                    <span class="label">Trust Score</span>
                    <span class="value" id="confidence-value">--/100</span>
                    <div class="mini-bar">
                        <div class="fill" style="width: 0%" id="meter-fill"></div>
                    </div>
                </div>
                <div class="metric-card">
                    <span class="label">Z-Score</span>
                    <span class="value" id="stat-zscore">--</span>
                </div>
                <div class="metric-card">
                    <span class="label">Baseline</span>
                    <span class="value" id="stat-baseline">--%</span>
                </div>
            </section>

            <!-- Dev/Demo Tools (Collapsible) -->
            <section class="dev-tools-card">
                <div class="card-header">
                    <span>üéõÔ∏è Demo Controls</span>
                </div>
                <div class="controls-body">
                    <div class="control-row">
                        <label>Threshold Mode</label>
                        <div class="toggle-group">
                            <span class="mode-label">Strict</span>
                            <input type="range" id="thresholdSlider" min="1.5" max="5.0" step="0.1" value="2.5"
                                oninput="updateThreshold(this.value)">
                            <span class="mode-label">Relaxed</span>
                        </div>
                        <div class="current-threshold">Current: <span id="thresholdValue">2.5</span></div>
                    </div>
                    <div class="control-row buttons-row" style="grid-template-columns: repeat(5, 1fr);">
                        <button class="btn-tool subtle" onclick="injectSubtle()">Subtle</button>
                        <button class="btn-tool moderate" onclick="injectModerate()">Seasonal</button>
                        <button class="btn-tool" style="border-bottom: 2px solid #8b5cf6;"
                            onclick="injectDuplicate()">Dupe</button>
                        <button class="btn-tool extreme" onclick="injectExtreme()">Extreme</button>
                        <button class="btn-tool reset" onclick="resetNormal()">Reset</button>
                    </div>
                </div>
            </section>

            <!-- Activity Timeline -->
            <section class="info-card">
                <div class="card-title">Activity Log</div>
                <div id="trust-timeline" class="activity-list">
                    <div class="empty-state">No activity recorded</div>
                </div>
            </section>

            <!-- AI Insights (Hidden by default, shown on data) -->
            <section class="info-card insights-card">
                <div class="card-title">üìä Signal Analysis</div>

                <div id="fingerprint-panel" class="insight-row hidden">
                    <div class="i-icon">üîç</div>
                    <div class="i-content">
                        <div class="i-title" id="fingerprint-pattern">--</div>
                        <div class="i-desc" id="fingerprint-desc">--</div>
                    </div>
                </div>

                <div id="prediction-panel" class="insight-row">
                    <div class="i-icon">üîÆ</div>
                    <div class="i-content">
                        <div class="i-title" id="prediction-status">Trend Analysis</div>
                        <div class="i-desc" id="prediction-message">Monitoring trajectory...</div>
                    </div>
                </div>

                <div id="propagation-panel" class="insight-row hidden">
                    <div class="i-icon">üåê</div>
                    <div class="i-content">
                        <div class="i-title">Impact Radius</div>
                        <div class="i-desc" id="propagation-message">--</div>
                    </div>
                </div>
            </section>

            <div class="spacer" style="height: 40px;"></div>
        </main>
    </div>

    <!-- Safety Overlay (Red Screen) -->
    <div id="safety-overlay" class="safety-overlay">
        <div class="overlay-container">
            <div class="lock-icon">‚õî</div>
            <h1 class="lock-title">Safety Lockdown</h1>
            <p class="lock-msg" id="safety-message">Anomaly detected. Dashboard access restricted.</p>

            <div class="lock-insights">
                <div class="lock-insight-row">
                    <span class="li-icon">üîç</span>
                    <span class="li-text" id="safety-fingerprint-desc">Analyzing root cause...</span>
                </div>
                <div class="lock-insight-row">
                    <span class="li-icon">üåê</span>
                    <span class="li-text" id="safety-propagation-msg">Assessing impact...</span>
                </div>
            </div>

            <div class="lock-actions">
                <button class="btn-lock primary" onclick="runAudit()">Re-Scan Data</button>
                <button class="btn-lock secondary" onclick="resetNormal()">Force Unlock</button>
            </div>
        </div>
    </div>

    <!-- Script v22 (Ensemble Detection) -->
    <script src="script.js?v=22"></script>
</body>

</html>